{"version":3,"sources":["util/audio.ts","components/curve.tsx","components/clipper.tsx","components/toggle-button.tsx","settings.ts","components/droparea.tsx","components/select-file.tsx","components/app.tsx","hooks/useDraggingOver.ts","index.tsx"],"names":["rms","pipe","map","x","mean","Math","sqrt","processChannel","samples","channelData","chunk","ceil","length","loadFileAsArrayBuffer","file","Promise","resolve","reject","reader","FileReader","readAsArrayBuffer","onload","e","result","onerror","Error","getChannels","a","channels","buffer","decodeAudio","audioData","i","numberOfChannels","push","Array","from","getChannelData","getBaseline","_","loadAudioData","processedChannels","float32ArraytoInt16Array","floatbuffer","int16Buffer","Int16Array","len","encodeMp3","bitrate","encoder","Mp3Encoder","sampleRate","encoded","encodeBuffer","Blob","type","clipChannels","start","end","audioBuffer","extractChannels","channel","subarray","arrayBuffer","window","AudioContext","webkitAudioContext","decodeAudioData","width","margin","innerWidth","innerHeight","xScale","scaleLinear","domain","numberOfSamples","range","yScale","shape","area","y0","y1","d","curve","curveBasis","Curve","graphData","currentTime","duration","trim","pathsRef","useRef","useEffect","paths","current","data","fill","yDomain","extent","flat","select","selectAll","join","transition","attr","playheadRef","playheadScale","datum","startMaskRef","endMaskRef","durationScale","startMask","endMask","console","log","JSON","stringify","height","viewBox","className","id","ref","y","transform","style","mixBlendMode","stroke","mask","opacity","Status","ToggleButton","status","onContent","offContent","onChange","onClick","classNames","statusTexts","NONE","READING_FILE","EXPORTING_MP3","Clipper","useState","isPlaying","setPlaying","setDuration","startTime","setStartTime","endTime","setEndTime","setCurrentTime","loop","setLoop","setStatus","setGraphData","then","updateMetadata","audio","audioRef","onloadedmetadata","onplay","onpause","playPause","useCallback","pause","play","animationFrame","tick","requestAnimationFrame","cancelAnimationFrame","src","URL","createObjectURL","revokeObjectURL","audioContext","blob","document","createElement","setAttribute","href","body","appendChild","click","Slider","value","newValue","min","max","step","dropzone","accept","multiple","DropArea","children","onDrop","isHidden","useDropzone","getRootProps","getInputProps","isDragActive","isDragReject","SelectFile","dropz","noClick","open","App","setFile","isDraggingOver","setDraggingOver","dragCount","handleDragOver","preventDefault","handleDragEnter","update","handleDragLeave","handleDrop","addEventListener","removeEventListener","useDraggingOver","acceptedFiles","theme","createMuiTheme","palette","primary","main","ReactDOM","render","StrictMode","ThemeProvider","getElementById"],"mappings":"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","file":"static/js/main.8dad51be.chunk.js","sourcesContent":["import { Mp3Encoder } from \"lamejs\";\nimport * as _ from \"lodash/fp\";\nimport { chunk, map, mean, pipe } from \"lodash/fp\";\n\nexport type Channels = [left: Int16Array, right?: Int16Array];\n\nexport const rms = pipe(\n  map((x: number) => x * x),\n  pipe(mean, Math.sqrt),\n);\n\nexport const processChannel = (samples: number) => (channelData: number[]): number[] =>\n  pipe(chunk(Math.ceil(channelData.length / samples)), map(rms))(channelData);\n\nexport const loadFileAsArrayBuffer = (file: File): Promise<ArrayBuffer> =>\n  new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.readAsArrayBuffer(file);\n    reader.onload = (e) => resolve(reader.result as ArrayBuffer);\n    reader.onerror = (e) => reject(new Error(\"Couldn't read file.\"));\n  });\n\nexport const getChannels = async (file: File): Promise<number[][]> => {\n  const channels: number[][] = [];\n  const buffer = await loadFileAsArrayBuffer(file);\n  const audioData = await decodeAudio(buffer);\n  for (let i = 0; i < audioData.numberOfChannels; i++) {\n    channels.push(Array.from(audioData.getChannelData(i)));\n  }\n  return channels;\n};\n\n// export const getBaseline = (channels: number[][]) => unzip(channels)\nconst getBaseline = _.pipe(_.unzip, _.map(_.min), _.map(_.toNumber));\n\nexport const loadAudioData = async (file: File, samples: number): Promise<number[][]> => {\n  const audioData = await getChannels(file);\n  const processedChannels = audioData.map(processChannel(samples));\n\n  return processedChannels.length === 1 ? processedChannels : [...processedChannels, getBaseline(processedChannels)];\n};\n\nexport function float32ArraytoInt16Array(floatbuffer: Float32Array): Int16Array {\n  var int16Buffer = new Int16Array(floatbuffer.length);\n  for (var i = 0, len = floatbuffer.length; i < len; i++) {\n    if (floatbuffer[i] < 0) {\n      int16Buffer[i] = 0x8000 * floatbuffer[i];\n    } else {\n      int16Buffer[i] = 0x7fff * floatbuffer[i];\n    }\n  }\n  return int16Buffer;\n}\n\nexport async function encodeMp3(channels: Channels, buffer: AudioBuffer, bitrate: number = 128): Promise<Blob> {\n  const encoder = new Mp3Encoder(buffer.numberOfChannels, buffer.sampleRate, bitrate);\n\n  switch (channels.length) {\n    case 1:\n    case 2: {\n      const encoded = encoder.encodeBuffer(...channels);\n      return new Blob([encoded], { type: \"audio/mp3\" });\n    }\n    default:\n      throw new Error(`Wrong number of channels: ${buffer.numberOfChannels}`);\n  }\n}\n\nexport function extractChannels(audioBuffer: AudioBuffer): Channels {\n  switch (audioBuffer.numberOfChannels) {\n    case 1: {\n      const mono = float32ArraytoInt16Array(audioBuffer.getChannelData(0));\n      return [mono];\n    }\n    case 2: {\n      const left = float32ArraytoInt16Array(audioBuffer.getChannelData(0));\n      const right = float32ArraytoInt16Array(audioBuffer.getChannelData(1));\n      return [left, right];\n    }\n    default:\n      throw new Error(`Wrong number of channels: ${audioBuffer.numberOfChannels}`);\n  }\n}\n\nexport function clipChannels(buffer: AudioBuffer, start: number, end: number): Channels {\n  const { sampleRate } = buffer;\n  const channels = extractChannels(buffer);\n  return channels.map((channel) => channel!.subarray(sampleRate * start, sampleRate * end)) as Channels;\n}\n\n// REFACTOR\n\ndeclare global {\n  interface Window {\n    webkitAudioContext: typeof AudioContext;\n  }\n}\n\nasync function decodeAudio(arrayBuffer: ArrayBuffer): Promise<AudioBuffer> {\n  return new Promise((resolve, reject) => {\n    const contextClass = window.AudioContext ?? window.webkitAudioContext;\n    const audioContext = new contextClass();\n    audioContext.decodeAudioData(arrayBuffer, resolve, () => reject(new Error(\"Couldn't decode audio\")));\n  });\n}\n","import { area, curveBasis, extent, scaleLinear, select } from \"d3\";\nimport React, { useEffect, useRef } from \"react\";\n\n/**\n * @todo send the audio processing to a worker\n */\n\nconst width = 1200;\nconst height = 120;\nconst margin = { top: 0, right: 0, bottom: 0, left: 0 };\nconst innerWidth = width - margin.left - margin.right;\nconst innerHeight = height - margin.top - margin.bottom;\nconst numberOfSamples = width / 5;\n\n// d3 configs\nconst xScale = scaleLinear()\n  .domain([0, numberOfSamples - 1])\n  .range([0, innerWidth]);\nconst yScale = scaleLinear().domain([0, 10]).range([innerHeight, 0]);\nconst shape = area<number>()\n  .x((_, i) => xScale(i))\n  .y0(innerHeight)\n  .y1((d) => yScale(d))\n  .curve(curveBasis);\n\ntype CurveProps = {\n  samples: number;\n  graphData: number[][] | null;\n  currentTime: number;\n  duration: number;\n  trim: [start: number, end: number];\n};\nexport default function Curve({ graphData, samples, currentTime, duration, trim }: CurveProps) {\n  const pathsRef = useRef<SVGGElement>(null);\n\n  // update the graph when de data changes\n  useEffect(() => {\n    const paths = pathsRef.current!;\n    const data = graphData !== null ? graphData : [Array(samples).fill(0.5)];\n    const yDomain = graphData !== null ? (extent(graphData.flat(2)) as [number, number]) : [0, 1];\n    yScale.domain(yDomain);\n    xScale.domain([0, samples]);\n\n    select(paths).selectAll(\"path\").data(data).join(\"path\").transition().attr(\"d\", shape);\n  }, [graphData, samples]);\n\n  // playhead\n  const playheadRef = useRef<SVGLineElement>(null);\n  const playheadScale = scaleLinear()\n    .domain([0, duration])\n    .range([1, innerWidth - 1]);\n  useEffect(() => {\n    select(playheadRef.current!)\n      .datum(currentTime)\n      .attr(\"x1\", playheadScale)\n      .attr(\"x2\", playheadScale)\n      .attr(\"y1\", 0)\n      .attr(\"y2\", innerHeight);\n  }, [currentTime, duration, playheadScale]);\n\n  // mask\n  const startMaskRef = useRef<SVGRectElement>(null);\n  const endMaskRef = useRef<SVGRectElement>(null);\n  useEffect(() => {\n    const durationScale = scaleLinear([0, duration], [0, innerWidth]);\n    const [start, end] = trim;\n    const startMask = startMaskRef.current;\n    const endMask = endMaskRef.current;\n\n    select(startMask)\n      .datum(start)\n      .attr(\"width\", (d) => durationScale(d));\n    select(endMask)\n      .datum(end)\n      .attr(\"x\", (d) => durationScale(d))\n      .attr(\"width\", (d) => durationScale(duration - d));\n  }, [trim, duration]);\n\n  useEffect(() => {\n    console.log(JSON.stringify(graphData));\n  }, [graphData]);\n\n  return (\n    <svg width={width} height={height} viewBox={`0 0 ${width} ${height}`} className=\"curve\">\n      <defs>\n        <mask id=\"selectionMask\">\n          <rect width=\"300\" height=\"100%\" fill=\"white\" ref={startMaskRef} />\n          <rect x=\"100%\" y=\"0\" height=\"100%\" fill=\"white\" ref={endMaskRef} />\n        </mask>\n      </defs>\n\n      <g transform={`translate(${margin.left}, ${margin.top})`}>\n        <g ref={pathsRef} className=\"curve__paths\">\n          <rect x=\"0\" y=\"0\" width={innerWidth} height={innerHeight} fill=\"#eadbf6\" />\n        </g>\n        <rect\n          x=\"0%\"\n          y=\"0%\"\n          height=\"100%\"\n          width=\"100%\"\n          style={{\n            mixBlendMode: \"saturation\",\n            fill: \"#ffffff\",\n            stroke: \"none\",\n          }}\n          mask=\"url(#selectionMask)\"\n        />\n        <rect\n          x=\"0\"\n          y=\"0\"\n          height=\"100%\"\n          width=\"100%\"\n          style={{\n            fill: \"#ffffff\",\n            opacity: 0.5,\n            stroke: \"none\",\n          }}\n          mask=\"url(#selectionMask)\"\n        />\n        <line ref={playheadRef} className=\"curve__playhead\" />\n      </g>\n    </svg>\n  );\n}\n","import Slider from \"@material-ui/core/Slider\";\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\nimport {\n  IoIosInfinite,\n  IoIosPlay,\n  IoMdDownload as IoIosDownload,\n} from \"react-icons/io\";\nimport { clipChannels, encodeMp3, loadAudioData } from \"../util/audio\";\nimport Curve from \"./curve\";\nimport ToggleButton from \"./toggle-button\";\n\nenum Status {\n  NONE,\n  READING_FILE,\n  EXPORTING_MP3,\n}\n\nconst statusTexts: { [k in Status]: string } = {\n  [Status.NONE]: \"\",\n  [Status.READING_FILE]: \"Reading file\",\n  [Status.EXPORTING_MP3]: \"Exporting MP3\",\n};\n\nconst SAMPLES = 300;\n\ntype ClipperProps = {\n  file: File;\n};\nexport default function Clipper({ file }: ClipperProps) {\n  const [isPlaying, setPlaying] = useState(false);\n  const [duration, setDuration] = useState(0);\n  const [startTime, setStartTime] = useState(0);\n  const [endTime, setEndTime] = useState(0);\n  const [currentTime, setCurrentTime] = useState(startTime);\n  const [loop, setLoop] = useState(false);\n  const [status, setStatus] = useState<Status>(Status.NONE);\n  const [graphData, setGraphData] = useState<number[][] | null>(null);\n\n  useEffect(() => {\n    setStatus(Status.READING_FILE);\n    loadAudioData(file, SAMPLES).then((graphData) => {\n      setGraphData(graphData);\n      setStatus(Status.NONE);\n    });\n  }, [file]);\n\n  const updateMetadata = () => {\n    const audio = audioRef.current!;\n    setDuration(audio.duration);\n    setEndTime(audio.duration);\n    setStartTime(0);\n    audio.currentTime = 0;\n  };\n\n  const audioRef = useRef<HTMLAudioElement>(null);\n  useEffect(() => {\n    audioRef.current!.onloadedmetadata = updateMetadata;\n    audioRef.current!.onplay = () => setPlaying(true);\n    audioRef.current!.onpause = () => setPlaying(false);\n  });\n\n  const playPause = useCallback(() => {\n    const audio = audioRef.current!;\n    if (isPlaying) {\n      audio.pause();\n    } else {\n      audio.play();\n    }\n  }, [isPlaying]);\n\n  // update currentTime\n  useEffect(() => {\n    const audio = audioRef.current!;\n    let animationFrame = 0;\n    const tick = () => {\n      setCurrentTime(audio.currentTime);\n      animationFrame = requestAnimationFrame(tick);\n    };\n    tick();\n    return () => {\n      if (animationFrame) cancelAnimationFrame(animationFrame);\n    };\n  }, []);\n\n  // go back to start time after playing\n  useEffect(() => {\n    const audio = audioRef.current!;\n    if (currentTime >= endTime) {\n      audio.currentTime = startTime;\n      if (!loop) {\n        audio.pause();\n      }\n    }\n  }, [currentTime, endTime, loop, startTime]);\n\n  // load dropped file into the audio element\n  useEffect(() => {\n    const audio = audioRef.current!;\n    audio.src = URL.createObjectURL(file);\n    audio.onload = () => {\n      URL.revokeObjectURL(audio.src);\n    };\n  }, [file]);\n\n  // sync current time with start time\n  useEffect(() => {\n    const audio = audioRef.current!;\n    audio.currentTime = startTime;\n  }, [startTime]);\n\n  const handleSelection = (\n    e: React.ChangeEvent<{}>,\n    newValue: number | number[],\n  ) => {\n    const [start, end] = newValue as [number, number];\n    setStartTime(start);\n    setEndTime(end);\n  };\n\n  async function handleDownload() {\n    // fetch file contents\n    const arrayBuffer = await file.arrayBuffer();\n\n    // decode audio data\n    const audioContext = new AudioContext();\n    const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);\n\n    // encode mp3\n    const channels = clipChannels(audioBuffer, startTime, endTime);\n    const blob = await encodeMp3(channels, audioBuffer);\n\n    // display audio\n    const a = document.createElement(\"a\");\n    a.setAttribute(\"download\", \"clip.mp3\");\n    a.setAttribute(\"hidden\", \"hidden\");\n    a.href = URL.createObjectURL(blob);\n    document.body.appendChild(a);\n    a.click();\n  }\n\n  return (\n    <div className=\"clipper\">\n      <div className=\"clipper__view\">\n        <Curve\n          graphData={graphData}\n          currentTime={currentTime}\n          duration={duration}\n          trim={[startTime, endTime]}\n          samples={SAMPLES}\n        />\n        <Slider\n          value={[startTime, endTime]}\n          onChange={handleSelection}\n          min={0}\n          max={duration}\n          step={0.001}\n        />\n        <audio ref={audioRef} />\n      </div>\n\n      <div className=\"clipper__controls\">\n        <div className=\"controls\">\n          <div className=\"controls__start\">\n            <ToggleButton\n              status={isPlaying}\n              onContent={<IoIosPlay />}\n              offContent={<IoIosPlay />}\n              onChange={playPause}\n            />{\" \"}\n            <ToggleButton\n              status={loop}\n              onContent={<IoIosInfinite />}\n              offContent={<IoIosInfinite />}\n              onChange={(loop) => setLoop(loop)}\n            />\n          </div>\n          <div className=\"controls__middle\">{statusTexts[status]}</div>\n          <div className=\"controls__end\">\n            <button onClick={handleDownload}>\n              <IoIosDownload />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import classNames from \"classnames\";\nimport React from \"react\";\n\ntype ToggleButtonProps = {\n  status: boolean;\n  onContent: React.ReactNode;\n  offContent: React.ReactNode;\n  onChange?(status: boolean): void;\n};\nexport default function ToggleButton({\n  status,\n  onContent,\n  offContent,\n  onChange,\n}: ToggleButtonProps) {\n  const handleClick = () => {\n    if (onChange) onChange(!status);\n  };\n\n  return (\n    <button\n      onClick={handleClick}\n      className={classNames(\"btn--toggle\", status ? \"btn--on\" : \"btn--off\")}\n    >\n      {status ? onContent : offContent}\n    </button>\n  );\n}\n","export const dropzone = { accept: \"audio/mpeg\", multiple: false };\n","import classNames from \"classnames\";\nimport React from \"react\";\nimport { useDropzone } from \"react-dropzone\";\nimport { dropzone } from \"../settings\";\n\ntype DropAreaProps = {\n  children: React.ReactNode;\n  isHidden: boolean;\n  onDrop: (acceptedFiles: File[]) => void;\n};\nexport default function DropArea({\n  children,\n  onDrop,\n  isHidden,\n}: DropAreaProps) {\n  const {\n    getRootProps,\n    getInputProps,\n    isDragActive,\n    isDragReject,\n  } = useDropzone({ ...dropzone, onDrop });\n\n  return (\n    <div\n      className={classNames(\n        \"drop-area\",\n        isDragActive && \"drop-area--active\",\n        isDragReject && \"drop-area--rejected\",\n        isHidden && \"drop-area--hidden\",\n      )}\n      {...getRootProps()}\n    >\n      <input {...getInputProps()} />\n      {children}\n    </div>\n  );\n}\n","import React from \"react\";\nimport { useDropzone } from \"react-dropzone\";\nimport { dropzone } from \"../settings\";\n\nexport default function SelectFile({ onDrop }) {\n  const dropz = useDropzone({\n    ...dropzone,\n    noClick: true,\n    onDrop,\n  });\n\n  return (\n    <div>\n      <button onClick={dropz.open}>Selecione um arquivo</button>\n      <input {...dropz.getInputProps()} />\n    </div>\n  );\n}\n","import React, { useCallback, useState } from \"react\";\nimport useDraggingOver from \"../hooks/useDraggingOver\";\nimport Clipper from \"./clipper\";\nimport DropArea from \"./droparea\";\nimport SelectFile from \"./select-file\";\n\nexport default function App() {\n  const [file, setFile] = useState<File | null>(null);\n  const isDraggingOver = useDraggingOver();\n\n  const onDrop = useCallback((acceptedFiles: File[]) => {\n    if (acceptedFiles.length < 1) return;\n    setFile(acceptedFiles[0]);\n  }, []);\n\n  return (\n    <div className=\"app\">\n      <div className=\"layout\">\n        {/* <nav className=\"layout__nav\"></nav> */}\n        <main className=\"layout__content\">\n          <h1>Clipit</h1>\n          {!file && (\n            <div className=\"begin text--center\">\n              <p>\n                Para começar, selecione um arquivo MP3 no seu computador. Você\n                também pode arrastar e soltar o arquivo em qualquer lugar da\n                página.\n              </p>\n              <SelectFile onDrop={onDrop} />\n              <p></p>\n            </div>\n          )}\n          {file && <Clipper file={file} />}\n        </main>\n        {/* <footer className=\"layout__footer\"></footer> */}\n      </div>\n\n      <DropArea isHidden={!isDraggingOver} onDrop={onDrop}>\n        🔥 drop it like it's hot 🔥\n      </DropArea>\n    </div>\n  );\n}\n","import { useEffect, useState } from \"react\";\n\nexport default function useDraggingOver() {\n  const [isDraggingOver, setDraggingOver] = useState(false);\n\n  useEffect(() => {\n    let dragCount = 0;\n\n    function handleDragOver(e: DragEvent) {\n      e.preventDefault();\n    }\n    function handleDragEnter(e: DragEvent) {\n      dragCount++;\n      update();\n    }\n    function handleDragLeave(e: DragEvent) {\n      dragCount--;\n      update();\n    }\n    function handleDrop(e: DragEvent) {\n      dragCount = 0;\n      update();\n    }\n    function update() {\n      setDraggingOver(dragCount > 0);\n    }\n\n    window.addEventListener(\"dragover\", handleDragOver);\n    window.addEventListener(\"dragenter\", handleDragEnter);\n    window.addEventListener(\"dragleave\", handleDragLeave);\n    window.addEventListener(\"drop\", handleDrop);\n\n    return () => {\n      window.removeEventListener(\"dragover\", handleDragOver);\n      window.removeEventListener(\"dragenter\", handleDragEnter);\n      window.removeEventListener(\"dragleave\", handleDragLeave);\n      window.removeEventListener(\"drop\", handleDrop);\n    };\n  }, []);\n\n  return isDraggingOver;\n}\n","import { createMuiTheme, ThemeProvider } from \"@material-ui/core\";\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport App from \"./components/app\";\nimport \"./styles.css\";\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: {\n      main: \"#8134af\",\n    },\n  },\n});\nReactDOM.render(\n  <React.StrictMode>\n    <ThemeProvider theme={theme}>\n      <App />\n    </ThemeProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\"),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\n// import * as serviceWorker from './serviceWorker';\n// serviceWorker.unregister();\n"],"sourceRoot":""}